<UserControl
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:metro="http://metro.mahapps.com/winfx/xaml/controls"
                xmlns:lex="http://wpflocalizeextension.codeplex.com" 
                xmlns:d="http://schemas.microsoft.com/expression/blend/2008" mc:Ignorable="d" x:Class="cntrl.toolBar" x:Name="_toolBar" 
                lex:LocalizeDictionary.DesignCulture="en-US" 
                lex:ResxLocalizationProvider.DefaultAssembly="Cognitivo"
                lex:ResxLocalizationProvider.DefaultDictionary="strings"
             Height="40" MinWidth="500" Loaded="UserControl_Loaded">
    <UserControl.Resources>
        <Storyboard x:Key="FormClick">
            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Panel.Background).(SolidColorBrush.Color)" Storyboard.TargetName="borderForm">
                <EasingColorKeyFrame KeyTime="0" Value="WhiteSmoke"/>
                <EasingColorKeyFrame KeyTime="0:0:0.5" Value="White"/>
            </ColorAnimationUsingKeyFrames>
            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Panel.Background).(SolidColorBrush.Color)" Storyboard.TargetName="borderGrid">
                <EasingColorKeyFrame KeyTime="0" Value="White"/>
                <EasingColorKeyFrame KeyTime="0:0:0.5" Value="WhiteSmoke"/>
            </ColorAnimationUsingKeyFrames>
            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Label.Foreground).(SolidColorBrush.Color)" Storyboard.TargetName="lblForm">
                <SplineColorKeyFrame KeyTime="0" Value="RosyBrown"/>
                <SplineColorKeyFrame KeyTime="0:0:0.5" Value="Crimson"/>
            </ColorAnimationUsingKeyFrames>
            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Label.Foreground).(SolidColorBrush.Color)" Storyboard.TargetName="lblGrid">
                <SplineColorKeyFrame KeyTime="0" Value="Crimson"/>
                <SplineColorKeyFrame KeyTime="0:0:0.5" Value="RosyBrown"/>
            </ColorAnimationUsingKeyFrames>
        </Storyboard>
        <Storyboard x:Key="GridClick">
            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Panel.Background).(SolidColorBrush.Color)" Storyboard.TargetName="borderForm">
                <SplineColorKeyFrame KeyTime="0" Value="White"/>
                <SplineColorKeyFrame KeyTime="0:0:0.5" Value="WhiteSmoke"/>
            </ColorAnimationUsingKeyFrames>
            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Panel.Background).(SolidColorBrush.Color)" Storyboard.TargetName="borderGrid">
                <SplineColorKeyFrame KeyTime="0" Value="WhiteSmoke"/>
                <SplineColorKeyFrame KeyTime="0:0:0.5" Value="White"/>
            </ColorAnimationUsingKeyFrames>
            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Label.Foreground).(SolidColorBrush.Color)" Storyboard.TargetName="lblForm">
                <SplineColorKeyFrame KeyTime="0" Value="Crimson"/>
                <SplineColorKeyFrame KeyTime="0:0:0.5" Value="RosyBrown"/>
            </ColorAnimationUsingKeyFrames>
            <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(Label.Foreground).(SolidColorBrush.Color)" Storyboard.TargetName="lblGrid">
                <SplineColorKeyFrame KeyTime="0" Value="RosyBrown"/>
                <SplineColorKeyFrame KeyTime="0:0:0.5" Value="Crimson"/>
            </ColorAnimationUsingKeyFrames>
        </Storyboard>
        <BooleanToVisibilityConverter x:Key="Bool2Visibility"/>
    </UserControl.Resources>
    <UserControl.Triggers>
        <EventTrigger RoutedEvent="FrameworkElement.Loaded">
            <BeginStoryboard x:Name="FormClick_BeginStoryboard" Storyboard="{StaticResource FormClick}"/>
        </EventTrigger>
        <EventTrigger RoutedEvent="UIElement.MouseUp" SourceName="borderForm">
            <BeginStoryboard Storyboard="{StaticResource FormClick}"/>
        </EventTrigger>
        <EventTrigger RoutedEvent="UIElement.MouseUp" SourceName="borderGrid">
            <BeginStoryboard x:Name="GridClick_BeginStoryboard" Storyboard="{StaticResource GridClick}"/>
        </EventTrigger>

    </UserControl.Triggers>
    <Grid x:Name="gridButtons" Background="White">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>

        <StackPanel x:Name="stackPanel" Orientation="Horizontal" Grid.Column="1" Visibility="{Binding ElementName=_toolBar, Path=MultipleStyleForm, FallbackValue=Collapsed, Converter={StaticResource Bool2Visibility}}"
                    HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,4,-34">
            <Border x:Name="borderForm" BorderBrush="Silver" BorderThickness="0.3,0,0.3,0.3" CornerRadius="0,0,4,4" 
                    Background="WhiteSmoke" Padding="2" Margin="4,0">
                <StackPanel Orientation="Horizontal" Cursor="Hand">
                    <Label x:Name="lblForm" Foreground="RosyBrown" Content="Z" FontSize="18" FontFamily="/cntrl;component/Resources/#cognitivo"/>
                    <TextBlock Text="{lex:Loc Form}" VerticalAlignment="Center" Margin="0,0,4,0"/>
                </StackPanel>
            </Border>
            <Border x:Name="borderGrid" BorderBrush="Silver" BorderThickness="0.3,0,0.3,0.3" CornerRadius="0,0,4,4" 
                    Background="WhiteSmoke" Padding="2">
                <StackPanel Orientation="Horizontal" Cursor="Hand">
                    <Label x:Name="lblGrid" Foreground="RosyBrown" Content="&#xE80D;" FontSize="18" FontFamily="/cntrl;component/Resources/#cognitivo"/>
                    <TextBlock Text="{lex:Loc Grid}" VerticalAlignment="Center" Margin="0,0,4,0"/>
                </StackPanel>
            </Border>
        </StackPanel>

        <Grid x:Name="gridSearch" Grid.Column="0" Background="{DynamicResource AccentColor_Brush}">
            <TextBox x:Name="tbxSearch" Padding="24,0,0,0" TextChanged="tbxSearchTextChanged"
				BorderBrush="Transparent" BorderThickness="0" Background="Transparent"
				FontSize="16" Foreground="Black" Margin="4"
                metro:TextBoxHelper.Watermark="{lex:Loc Search}"
				metro:TextBoxHelper.SelectAllOnFocus="True"
				metro:ControlsHelper.MouseOverBorderBrush="Transparent"
				metro:ControlsHelper.FocusBorderBrush="Transparent"
				metro:TextBoxHelper.ClearTextButton="True"/>
            <TextBlock Text="L" FontFamily="/cntrl;component/Resources/#cognitivo"
				FontSize="24" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="8">
                <TextBlock.Foreground>
                    <SolidColorBrush Color="Black" Opacity="0.75"/>
                </TextBlock.Foreground>
            </TextBlock>
        </Grid>

        <Grid Grid.Column="1" >
            <StackPanel x:Name="stackMain" Orientation="Horizontal" HorizontalAlignment="Left" />
            <StackPanel x:Name="stackSide" Orientation="Horizontal" HorizontalAlignment="Right" />
        </Grid>

        <Popup HorizontalAlignment="Right" x:Name="popMessages" AllowsTransparency="True">
            <StackPanel x:Name="stackMessages" Margin="0,5" Width="{Binding ActualWidth, ElementName=gridButtons, Mode=OneWay}"/>
        </Popup>
    </Grid>
</UserControl>