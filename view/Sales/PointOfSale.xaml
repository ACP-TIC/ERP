<Page x:Class="Cognitivo.Sales.PointOfSale"
      xmlns:main="clr-namespace:Cognitivo.Properties"
      xmlns:pref="clr-namespace:Cognitivo.Sales"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:cntrl="clr-namespace:cntrl.Controls;assembly=cntrl"
      xmlns:curd="clr-namespace:cntrl.Curd;assembly=cntrl"
      xmlns:customcmd="clr-namespace:Cognitivo.Class"
      xmlns:entity="clr-namespace:entity;assembly=entity"
      xmlns:metro="http://metro.mahapps.com/winfx/xaml/controls"
      xmlns:lex="http://wpflocalizeextension.codeplex.com" 
      lex:ResxLocalizationProvider.DefaultAssembly="Cognitivo" 
      lex:ResxLocalizationProvider.DefaultDictionary="local"
      lex:LocalizeDictionary.DesignCulture="en-US" 
      mc:Ignorable="d" d:DesignHeight="600" d:DesignWidth="800"
	  Title="{lex:Loc PointOfSale}" Loaded="Page_Loaded" KeyDown="Page_KeyDown">
    <Page.CommandBindings>
        <CommandBinding x:Name="DeleteCommand" Command="customcmd:CustomCommands.Delete" 
                        CanExecute="DeleteCommandBinding_CanExecute" 
                        Executed="DeleteCommandBinding_Executed"/>
    </Page.CommandBindings>
    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        <CollectionViewSource x:Key="sales_invoiceViewSource" d:DesignSource="{d:DesignInstance {x:Type entity:sales_invoice}, CreateList=True}" />
        <CollectionViewSource x:Key="sales_invoicesales_invoice_detailViewSource" Source="{Binding sales_invoice_detail, Source={StaticResource sales_invoiceViewSource}}"/>
        <CollectionViewSource x:Key="app_vat_groupViewSource" d:DesignSource="{d:DesignInstance {x:Type entity:app_vat_group}, CreateList=True}"/>
        <CollectionViewSource x:Key="payment_typeViewSource" d:DesignSource="{d:DesignInstance {x:Type entity:payment_type}, CreateList=True}"/>
        <CollectionViewSource x:Key="app_currencyViewSource" d:DesignSource="{d:DesignInstance {x:Type entity:app_currencyfx}, CreateList=True}"/>
        <CollectionViewSource x:Key="paymentViewSource" d:DesignSource="{d:DesignInstance {x:Type entity:payment}, CreateList=True}" />
        <CollectionViewSource x:Key="paymentpayment_detailViewSource" Source="{Binding payment_detail, Source={StaticResource paymentViewSource}}"/>
        <Storyboard x:Key="stackLeftOpen">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)" Storyboard.TargetName="stackLeft">
                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="1"/>
            </DoubleAnimationUsingKeyFrames>
            <PointAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransformOrigin)" Storyboard.TargetName="stackLeft">
                <EasingPointKeyFrame KeyTime="0" Value="0,0"/>
                <EasingPointKeyFrame KeyTime="0:0:0.5" Value="0.5,0.5"/>
            </PointAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.Y)" Storyboard.TargetName="stackLeft">
                <EasingDoubleKeyFrame KeyTime="0" Value="-24"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
        <Storyboard x:Key="stackRightOpen">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)" Storyboard.TargetName="stackRight">
                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="1"/>
            </DoubleAnimationUsingKeyFrames>
            <PointAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransformOrigin)" Storyboard.TargetName="stackRight">
                <EasingPointKeyFrame KeyTime="0" Value="0,0"/>
                <EasingPointKeyFrame KeyTime="0:0:0.5" Value="0.5,0.5"/>
            </PointAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.Y)" Storyboard.TargetName="stackRight">
                <EasingDoubleKeyFrame KeyTime="0" Value="72"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
    </Page.Resources>
    <Page.Triggers>
        <EventTrigger RoutedEvent="UIElement.MouseEnter" SourceName="stackLeft1">
            <BeginStoryboard Storyboard="{StaticResource stackLeftOpen}"/>
        </EventTrigger>
        <EventTrigger RoutedEvent="UIElement.MouseEnter" SourceName="gridBottom">
            <BeginStoryboard x:Name="stackRightOpen_BeginStoryboard" Storyboard="{StaticResource stackRightOpen}"/>
        </EventTrigger>
    </Page.Triggers>
    <Grid DataContext="{StaticResource sales_invoiceViewSource}">
        <Grid.Background>
            <ImageBrush ImageSource="{Binding Source={x:Static main:Settings.Default}, Path=wallpaper_Image}" Stretch="UniformToFill"/>
        </Grid.Background>
        <Grid Style="{StaticResource ThemeBackGround}"/>


        <Grid x:Name="gridBottom" VerticalAlignment="Top" Height="40">
            <Grid.Background>
                <SolidColorBrush Color="Black" Opacity=".64"/>
            </Grid.Background>

            <StackPanel x:Name="stackLeft1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left" Cursor="Hand">
                <Ellipse HorizontalAlignment="Center" VerticalAlignment="Top" 
                             Height="32" Width="32"
                             Margin="4">
                    <Ellipse.Fill>
                        <ImageBrush Stretch="UniformToFill" ImageSource="/Cognitivo;component/Images/Cognitivo-64.png"/>
                    </Ellipse.Fill>
                </Ellipse>
                <Label Style="{StaticResource H3}" VerticalAlignment="Center" Content="Cognitivo ERP" Foreground="White"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="4,-6, 4, 0">
                <Label x:Name="lblGrandTotalsales" FontSize="30" Foreground="White"
                       TargetUpdated="lblGrandTotalsales_DataContextChanged" ContentStringFormat="N2"
                       Content="{Binding GrandTotal, StringFormat={}{0:N2}, Mode=OneWay, NotifyOnTargetUpdated=True, UpdateSourceTrigger=PropertyChanged, Source={StaticResource sales_invoiceViewSource}}">
                    <Label.Effect>
                        <DropShadowEffect Color="White" ShadowDepth="0"/>
                    </Label.Effect>
                </Label>
                <TextBlock FontSize="16" Foreground="Gainsboro" Margin="4,0" VerticalAlignment="Center"
                           Text="{Binding app_currencyfx.app_currency.name, FallbackValue=FX, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Source={StaticResource sales_invoiceViewSource}}">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="Gainsboro" ShadowDepth="0"/>
                    </TextBlock.Effect>
                </TextBlock>
            </StackPanel>
        </Grid>

        <StackPanel Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Center" Margin="0,64,0,0">
            <Border CornerRadius="32" Background="WhiteSmoke" Width="64" Height="64" 
                    Cursor="Hand" MouseDown="btnClient_Click" TouchDown="btnClient_Click"
                    BorderBrush="White" BorderThickness="4" ToolTip="F1">
                <Border.Effect>
                    <DropShadowEffect Color="Black" ShadowDepth="0" />
                </Border.Effect>
                <Label Content="U" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="32" 
                       VerticalAlignment="Center" HorizontalAlignment="Center" 
                       Foreground="Black"/>
            </Border>


            <Rectangle Height="1" Width="64" Margin="8" Fill="White" Opacity="0.32"/>

            <Border CornerRadius="32" Background="WhiteSmoke" Width="64" Height="64" 
                    Cursor="Hand" MouseDown="btnSales_Click" TouchDown="btnSales_Click"
                    BorderBrush="White" BorderThickness="4" ToolTip="F2">
                <Border.Effect>
                    <DropShadowEffect Color="Black" ShadowDepth="0" />
                </Border.Effect>
                <Label Content="" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="32" 
                       VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="Black"/>
            </Border>

            <Rectangle Height="1" Width="64" Margin="8" Fill="White" Opacity="0.32"/>

            <Border CornerRadius="32" Background="WhiteSmoke" Width="64" Height="64" 
                    Cursor="Hand" MouseDown="btnPayment_Click" TouchDown="btnPayment_Click"
                    BorderBrush="White" BorderThickness="4" ToolTip="F3">
                <Border.Effect>
                    <DropShadowEffect Color="Black" ShadowDepth="0" />
                </Border.Effect>
                <Label Content="$" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="32" Foreground="Black"
                       VerticalAlignment="Center" HorizontalAlignment="Center"/>
            </Border>
        </StackPanel>
        <TabControl x:Name="postab"  Margin="10,150,10,10">
            <!-- Account-->
            <TabItem x:Name="tabAccount">
                <Frame x:Name="frmaccount" NavigationUIVisibility="Hidden" Content="AccountActive" Source="/Cognitivo;component/Configs/AccountActive.xaml"/>
            </TabItem>
            <!-- CONTACT -->
            <TabItem x:Name="tabContact" >
                <StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="16">
                        <StackPanel.Effect>
                            <DropShadowEffect ShadowDepth="0" Color="White"/>
                        </StackPanel.Effect>
                        <Label Content="U" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="32" 
                               VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="White"/>
                        <Label Content="{lex:Loc Customer}" metro:ControlsHelper.ContentCharacterCasing="Upper" Style="{StaticResource H1}" Foreground="White"/>
                    </StackPanel>
                    <Viewbox StretchDirection="Both" Stretch="Uniform" Width="512" Height="64">
                        <cntrl:SmartBox_Contact x:Name="sbxContact"
                                                HorizontalAlignment="Center" 
                                                Get_Customers="True" 
                                                Select="sbxContact_Select"/>
                    </Viewbox>
                    <Viewbox Margin="16" VerticalAlignment="Top" HorizontalAlignment="Center" StretchDirection="Both" Stretch="Uniform" Height="45">
                        <Grid Cursor="Hand" MouseDown="btnNewCustomer_MouseDown" TouchDown="btnNewCustomer_MouseDown" ToolTip="{lex:Loc New}">
                            <Border CornerRadius="5,16,16,5" VerticalAlignment="Center" HorizontalAlignment="Left">
                                <Border.Background>
                                    <SolidColorBrush Color="#FF004867" Opacity="0.32"/>
                                </Border.Background>
                                <StackPanel Orientation="Horizontal" Margin="2,0,32,0">
                                    <TextBlock Style="{StaticResource text_Label}" Foreground="WhiteSmoke">
                                        <Run Text="{lex:Loc Create}"/>
                                        <Run Text="{lex:Loc Customer}"/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                            <Border CornerRadius="32" Background="#FF004867" Width="32" Height="32" VerticalAlignment="Top" HorizontalAlignment="Right"
                                BorderBrush="White" BorderThickness="1">
                                <Label Content="U" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="15" 
                                   VerticalAlignment="Center" HorizontalAlignment="Center" 
                                   Foreground="White"/>
                            </Border>
                        </Grid>
                    </Viewbox>
                    <Popup x:Name="popCrud" PopupAnimation="Scroll" Placement="Mouse" Visibility="Visible">
                        <StackPanel x:Name="stackCustomer"/>
                    </Popup>
                </StackPanel>
            </TabItem>
            <!-- VENTAS -->
            <TabItem x:Name="tabSales">
                <Grid>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="16" VerticalAlignment="Top">
                        <StackPanel.Effect>
                            <DropShadowEffect ShadowDepth="0" Color="White"/>
                        </StackPanel.Effect>
                        <Label Content="" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="32" 
                            VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="White"/>
                        <Label Content="{lex:Loc Sales}" metro:ControlsHelper.ContentCharacterCasing="Upper" Style="{StaticResource H1}" Foreground="White"/>
                    </StackPanel>
                    <Viewbox StretchDirection="Both" Stretch="Uniform" Width="512" Height="60" VerticalAlignment="Top" Margin="0,80,0,0">
                        <cntrl:SmartBox_Item x:Name="sbxItem" HorizontalAlignment="Center" Select="sbxItem_Select"/>
                    </Viewbox>
                    <DataGrid x:Name="dgvSalesDetail" Style="{StaticResource detail_Datagrid}" ScrollViewer.CanContentScroll="True"
                              Margin="64,155,64,15" CanUserAddRows="False" FontSize="16" ScrollViewer.VerticalScrollBarVisibility="Auto"
                              ItemsSource="{Binding Source={StaticResource sales_invoicesales_invoice_detailViewSource}}" 
                              RowEditEnding="dgvSalesDetail_RowEditEnding">
                        <DataGrid.RowBackground>
                            <SolidColorBrush Color="White" Opacity="0.32"/>
                        </DataGrid.RowBackground>
                        <DataGrid.Background>
                            <SolidColorBrush Color="White" Opacity="0.32"/>
                        </DataGrid.Background>
                        <DataGrid.Columns>
                            <DataGridTextColumn Binding="{Binding item.code, UpdateSourceTrigger=PropertyChanged}" 
                                                Header="{lex:Loc Cognitivo:local:Code}" IsReadOnly="True" Width="100"/>
                            <DataGridTextColumn Binding="{Binding item_description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                Header="{lex:Loc Cognitivo:local:Item}" IsReadOnly="True" Width="*"/>
                            <DataGridComboBoxColumn x:Name="cbxLocation" Header="{lex:Loc Cognitivo:local:Location}" SelectedValueBinding="{Binding id_location,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                            DisplayMemberPath="name" SelectedValuePath="id_location"/>
                            <DataGridTextColumn Binding="{Binding vat_group.name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" FontWeight="Bold"
                                                Header="{lex:Loc Cognitivo:local:VAT}" IsReadOnly="True" Width="*" Visibility="Hidden"/>
                            <DataGridTextColumn Binding="{Binding quantity, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N}, ValidatesOnDataErrors=True}" 
                                                Header="{lex:Loc Cognitivo:local:Quantity}" Width="100" ElementStyle="{StaticResource RightAlignStyle}" />
                            <!-- UnitPrice -->
                            <DataGridTextColumn Header="{lex:Loc Cognitivo:local:Price}" Width="100" ElementStyle="{StaticResource RightAlignStyle}" IsReadOnly="True"
                                                Binding="{Binding unit_price, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N}, ValidatesOnDataErrors=True}" 
                                                Visibility="{Binding Source={x:Static pref:Settings.Default}, Path=VATExcluded, Converter={StaticResource BoolToVisibility}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>
                            <DataGridTextColumn Binding="{Binding discount, StringFormat={}{0:N}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"  
                                                Header="{lex:Loc Discount}" Width="Auto" ElementStyle="{StaticResource RightAlignStyle}" Foreground="Crimson"
                                                Visibility="{Binding Source={x:Static pref:Settings.Default}, Path=VATExcluded, Converter={StaticResource BoolToVisibility}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>
                            <!-- UnitPrice_Vat -->
                            <DataGridTextColumn Binding="{Binding UnitPrice_Vat, StringFormat={}{0:N}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" 
                                                Header="{lex:Loc Cognitivo:local:PricewithVAT}" ElementStyle="{StaticResource RightAlignStyle}" Width="Auto"  IsReadOnly="True"
                                                Visibility="{Binding Source={x:Static pref:Settings.Default}, Path=VATIncluded, Converter={StaticResource BoolToVisibility}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>
                            <DataGridTextColumn Binding="{Binding DiscountVat, StringFormat={}{0:N}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"  
                                                Header="{lex:Loc Discount}" Width="Auto" ElementStyle="{StaticResource RightAlignStyle}" Foreground="Crimson"
                                                Visibility="{Binding Source={x:Static pref:Settings.Default}, Path=VATIncluded, Converter={StaticResource BoolToVisibility}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>
                            <!-- SubTotal -->
                            <DataGridTextColumn Binding="{Binding SubTotal, StringFormat={}{0:N}, ValidatesOnDataErrors=True}" 
                                                Header="{lex:Loc Cognitivo:local:SubTotal}" Width="Auto" IsReadOnly="True" FontWeight="Bold"
                                                Visibility="{Binding Source={x:Static pref:Settings.Default}, Path=VATExcluded, Converter={StaticResource BoolToVisibility}, 
                                                UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" ElementStyle="{StaticResource RightAlignStyle}"/>
                            <DataGridTextColumn Binding="{Binding Discount_SubTotal,Mode=TwoWay, StringFormat={}{0:N}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" 
                                                Foreground="Crimson" Header="{lex:Loc Cognitivo:local:Discount}" Width="Auto" ElementStyle="{StaticResource RightAlignStyle}"
                                                Visibility="{Binding Source={x:Static pref:Settings.Default}, Path=VATExcluded, Converter={StaticResource BoolToVisibility}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>
                            <!-- SubTotal_VAT -->
                            <DataGridTextColumn Binding="{Binding SubTotal_Vat, StringFormat={}{0:N}, ValidatesOnDataErrors=True}" FontWeight="Bold" Header="{lex:Loc Cognitivo:local:SubTotalwithVAT}" 
                                                Visibility="{Binding Source={x:Static pref:Settings.Default}, Path=VATIncluded, Converter={StaticResource BoolToVisibility}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"
                                                Width="Auto" IsReadOnly="True" ElementStyle="{StaticResource RightAlignStyle}" />
                            <DataGridTextColumn Binding="{Binding Discount_SubTotal_Vat, StringFormat={}{0:N}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" 
                                                Foreground="Crimson" Header="{lex:Loc Cognitivo:local:Discount}" Width="Auto" ElementStyle="{StaticResource RightAlignStyle}" IsReadOnly="True"
                                                Visibility="{Binding Source={x:Static pref:Settings.Default}, Path=VATIncluded, Converter={StaticResource BoolToVisibility}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>
                            <DataGridTemplateColumn Width="Auto" Header="" >
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Command="customcmd:CustomCommands.Delete"
                                                Style="{StaticResource btnDeleteChildStyle}"
                                                CommandParameter="{Binding}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
            <!-- PAYMENT -->
            <TabItem x:Name="tabPayment">
                <StackPanel>
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="16">
                            <StackPanel.Effect>
                                <DropShadowEffect ShadowDepth="0" Color="White"/>
                            </StackPanel.Effect>
                            <Label Content="$" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="32" 
                                   VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="White"/>
                            <Label Content="{lex:Loc Payment}" Style="{StaticResource H1}" Foreground="White"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Center">
                            
                            <!-- PRINT PAYMENT -->
                            <Grid Margin="8" VerticalAlignment="Top" HorizontalAlignment="Center" ToolTip="{lex:Loc Print}"
                                  MouseUp="NewPayment_MouseUp">
                                <Border CornerRadius="16,5,5,16" VerticalAlignment="Center" HorizontalAlignment="Left">
                                    <Border.Background>
                                        <SolidColorBrush Color="#FF004867" Opacity="0.32"/>
                                    </Border.Background>
                                    <StackPanel Orientation="Horizontal" Margin="32,0,2,0">
                                        <TextBlock Style="{StaticResource text_Label}" Foreground="WhiteSmoke" Margin="8">
                                                <Run Text="{lex:Loc New}" />
                                                <Run Text="{lex:Loc Payment}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                                <Border CornerRadius="32" Background="#FF004867" Width="32" Height="32" VerticalAlignment="Top" HorizontalAlignment="Left"
                                    BorderBrush="White" BorderThickness="1">
                                    <Label Content="+" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="15" 
                                       VerticalAlignment="Center" HorizontalAlignment="Center" 
                                       Foreground="White"/>
                                </Border>
                            </Grid>

                            <!-- PRINT PAYMENT -->
                            <Grid Margin="8" ToolTip="{lex:Loc Print}">
                                <Border CornerRadius="16,5,5,16" VerticalAlignment="Center" HorizontalAlignment="Left">
                                    <Border.Background>
                                        <SolidColorBrush Color="#FF004867" Opacity="0.32"/>
                                    </Border.Background>
                                    <StackPanel Orientation="Horizontal" Margin="32,0,2,0">
                                        <CheckBox x:Name="chkreceipt" Style="{StaticResource input_checkbox}" Width="Auto">
                                            <CheckBox.Content>
                                                <TextBlock Style="{StaticResource text_Label}" Foreground="WhiteSmoke">
                                                <Run Text="{lex:Loc Print}" />
                                                <Run Text="{lex:Loc Payment}"/>
                                                </TextBlock>
                                            </CheckBox.Content>
                                        </CheckBox>
                                    </StackPanel>
                                </Border>
                                <Border CornerRadius="32" Background="#FF004867" Width="32" Height="32" VerticalAlignment="Center" HorizontalAlignment="Left"
                                        BorderBrush="White" BorderThickness="1">
                                    <Label Content="p" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="15" 
                                           VerticalAlignment="Center" HorizontalAlignment="Center" 
                                           Foreground="White"/>
                                </Border>
                            </Grid>
                        </StackPanel>
                      
                        <DataGrid x:Name="dgvPaymentDetail" Style="{StaticResource detail_Datagrid}" Margin="0,24,0,0" HorizontalAlignment="Center" FontSize="16"
                                      ItemsSource="{Binding Source={StaticResource paymentpayment_detailViewSource}}" InitializingNewItem="dgvPaymentDetail_InitializingNewItem">
                            <DataGrid.Columns>
                                <DataGridComboBoxColumn Header="{lex:Loc Cognitivo:local:Type}" Width="128"
					                            ItemsSource="{Binding Source={StaticResource payment_typeViewSource}}"  
                                                DisplayMemberPath="name" SelectedValuePath="id_payment_type" 
					                            SelectedValueBinding="{Binding id_payment_type, Mode=TwoWay, NotifyOnValidationError=True,  
                                                UpdateSourceTrigger=PropertyChanged}"/>

                                <DataGridTextColumn Binding="{Binding ValueInDefaultCurrency, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N2}}"
                                                        ElementStyle="{StaticResource RightAlignStyle}" IsReadOnly="True" CanUserResize="False"
                                                        Header="En Dolar" MaxWidth="1" FontWeight="Bold"/>
                                <DataGridTextColumn Binding="{Binding value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:N2}}"
                                                        ElementStyle="{StaticResource RightAlignStyle}"
                                                        Header="{lex:Loc Cognitivo:local:Value}" Width="256" FontWeight="Bold"/>
                                
                                <DataGridComboBoxColumn Header="{lex:Loc Cognitivo:local:Currency}" Width="128"
					                            ItemsSource="{Binding Source={StaticResource app_currencyViewSource}}"  
                                                DisplayMemberPath="name" SelectedValuePath="id_currency" 
					                            SelectedValueBinding="{Binding id_currency, Mode=TwoWay, NotifyOnValidationError=True, ValidatesOnExceptions=True, 
                                                UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>
                                <DataGridTemplateColumn Width="Auto" Header="">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Command="customcmd:CustomCommands.Delete"
                                                    Style="{StaticResource btnDeleteChildStyle}"
                                                    CommandParameter="{Binding}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                        <StackPanel Orientation="Horizontal"  HorizontalAlignment="Center" Margin="128,0">
                            <TextBlock  FontSize="30" Foreground="White" HorizontalAlignment="Center">
                                <TextBlock.Effect>
                                    <DropShadowEffect Color="White" ShadowDepth="0"/>
                                </TextBlock.Effect>
                                <Run Text="{lex:Loc Total}"/>
                                <Run Text="{lex:Loc Payment}"/>
                            </TextBlock>
                            <Label Content=" "/>
                            <!--<TextBlock FontSize="30" Foreground="White"
                                       Text="{Binding GrandTotalDetail, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Source={StaticResource paymentViewSource}}">
                                <TextBlock.Effect>
                                    <DropShadowEffect Color="White" ShadowDepth="0"/>
                                </TextBlock.Effect>
                            </TextBlock>-->
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </TabItem>
        </TabControl>

        <!-- SalesMan -->
        <StackPanel x:Name="stackLeft" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="0,40" RenderTransformOrigin="0.5,0.5">
            <StackPanel.RenderTransform>
                <TransformGroup>
                    <ScaleTransform/>
                    <SkewTransform/>
                    <RotateTransform/>
                    <TranslateTransform/>
                </TransformGroup>
            </StackPanel.RenderTransform>
            <!-- User -->
            <Grid Margin="8" VerticalAlignment="Top" HorizontalAlignment="Left">
                <Border CornerRadius="16,5,5,16" VerticalAlignment="Center" HorizontalAlignment="Left">
                    <Border.Background>
                        <SolidColorBrush Color="White" Opacity="0.64"/>
                    </Border.Background>
                    <StackPanel Orientation="Horizontal" Margin="32,0,2,0">
                        <Label Content="{lex:Loc Salesman}" Style="{StaticResource input_label}" Foreground="Black"/>
                            <ComboBox x:Name="cbxSalesRep" Style="{StaticResource ComboToLabelStyle}"
                                  metro:ControlsHelper.FocusBorderBrush="RoyalBlue"
                                  metro:ControlsHelper.MouseOverBorderBrush="Silver"
						          DisplayMemberPath="name" Width="Auto"
						          SelectedValuePath="id_sales_rep" 
						          SelectedValue="{Binding id_sales_rep, Mode=TwoWay, NotifyOnValidationError=True, Source={StaticResource sales_invoiceViewSource}, ValidatesOnExceptions=True, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"  >
                            <ComboBox.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <VirtualizingStackPanel/>
                                </ItemsPanelTemplate>
                            </ComboBox.ItemsPanel>
                        </ComboBox>
                    </StackPanel>
                </Border>
                <Border CornerRadius="32" Background="#FF004867" Width="32" Height="32" VerticalAlignment="Top" HorizontalAlignment="Left"
                        BorderBrush="White" BorderThickness="1">
                    <Label Content="S" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="15" 
                           VerticalAlignment="Center" HorizontalAlignment="Center" 
                           Foreground="White"/>
                </Border>
            </Grid>
        </StackPanel>

        <StackPanel x:Name="stackRight" VerticalAlignment="Top" HorizontalAlignment="Right" Margin="0,40" RenderTransformOrigin="0.5,0.5">
            <StackPanel.RenderTransform>
                <TransformGroup>
                    <ScaleTransform/>
                    <SkewTransform/>
                    <RotateTransform/>
                    <TranslateTransform/>
                </TransformGroup>
            </StackPanel.RenderTransform>

            <!-- Discount -->
            <Grid Margin="8" VerticalAlignment="Top" HorizontalAlignment="Right"
                  Cursor="Hand" ToolTip="{lex:Loc Discount}"
                  MouseUp="boderdiscount_MouseDown" TouchUp="boderdiscount_MouseDown">
                <Border CornerRadius="5,16,16,5" VerticalAlignment="Center" HorizontalAlignment="Left">
                    <Border.Background>
                        <SolidColorBrush Color="#FF004867" Opacity="0.32"/>
                    </Border.Background>
                    <StackPanel Orientation="Horizontal" Margin="2,0,32,0">
                        <Label Content="{lex:Loc Discount}" Style="{StaticResource input_label}" Foreground="WhiteSmoke"/>
                    </StackPanel>
                </Border>
                <Border CornerRadius="32" Background="#FF004867" Width="32" Height="32" VerticalAlignment="Top" HorizontalAlignment="Right"
                        BorderBrush="White" BorderThickness="1">
                    <Grid>
                        <Popup x:Name="popupDiscount" Placement="Top" StaysOpen="False" IsOpen="False" Closed="popupCustomize_Closed">
                            <Grid Background="{StaticResource AccentColor_Introvert}">
                                <Grid.Effect>
                                    <DropShadowEffect ShadowDepth="0" Opacity="0.75" />
                                </Grid.Effect>
                                <StackPanel Margin="8">
                                    <Label Content="Discount(%)" Style="{StaticResource input_label}"/>
                                    <TextBox metro:TextBoxHelper.SelectAllOnFocus="True" 
                                             Text="{Binding DiscountPercentage, Source={StaticResource sales_invoiceViewSource}, StringFormat={}{0:P}, Mode=TwoWay, UpdateSourceTrigger=LostFocus}" Width="128"/>
                                    <Label Content="Discount" Style="{StaticResource input_label}"/>
                                    <TextBox metro:TextBoxHelper.SelectAllOnFocus="True" 
                                             Text="{Binding DiscountWithoutPercentage, Source={StaticResource sales_invoiceViewSource}, StringFormat={}{0:N}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="128"/>
                                </StackPanel>
                                <Polygon Margin="0,0,0,-10" VerticalAlignment="Bottom" HorizontalAlignment="Left" Points="0,0 8,10, 16,0" Fill="{StaticResource AccentColor_Introvert}" />
                            </Grid>
                        </Popup>
                        <Label Content="%" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="15" 
                               VerticalAlignment="Center" HorizontalAlignment="Center" 
                               Foreground="White"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- Approve -->
            <Viewbox Margin="8" StretchDirection="Both" Stretch="Uniform" Height="50" VerticalAlignment="Top" HorizontalAlignment="Right">
                <Grid Cursor="Hand" MouseDown="btnSave_Click" TouchDown="btnSave_Click" ToolTip="{lex:Loc Approve}">
                    <Border CornerRadius="5,16,16,5" VerticalAlignment="Center" HorizontalAlignment="Left">
                        <Border.Background>
                            <SolidColorBrush Color="#FF004867" Opacity="0.32"/>
                        </Border.Background>
                        <StackPanel Orientation="Horizontal" Margin="2,0,32,0">
                            <TextBlock Style="{StaticResource text_Label}" Foreground="WhiteSmoke">
                                <Run Text="{lex:Loc Save}"/>
                                <Run Text="&amp;"/>
                                <Run Text="{lex:Loc Print}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>
                    <Border CornerRadius="32" Background="#FF004867" Width="32" Height="32" VerticalAlignment="Top" HorizontalAlignment="Right"
                            BorderBrush="White" BorderThickness="1">
                        <Label Content="p" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="15" 
                               VerticalAlignment="Center" HorizontalAlignment="Center" 
                               Foreground="White"/>
                    </Border>
                </Grid>
            </Viewbox>

            <!-- Cancel -->
            <Grid Margin="8" VerticalAlignment="Top" HorizontalAlignment="Right"
                  Cursor="Hand" MouseDown="Cancel_MouseDown" TouchDown="Cancel_MouseDown" ToolTip="{lex:Loc Cancel}">
                <Border CornerRadius="5,16,16,5" VerticalAlignment="Center" HorizontalAlignment="Left">
                    <Border.Background>
                        <SolidColorBrush Color="#FF004867" Opacity="0.32"/>
                    </Border.Background>
                    <StackPanel Orientation="Horizontal" Margin="2,0,32,0">
                        <Label Content="{lex:Loc Cancel}" Style="{StaticResource input_label}" Foreground="WhiteSmoke"/>
                    </StackPanel>
                </Border>
                <Border CornerRadius="32" Background="#FF004867" Width="32" Height="32" VerticalAlignment="Top" HorizontalAlignment="Right"
                        BorderBrush="White" BorderThickness="1">
                    <Label Content="c" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="15" 
                           VerticalAlignment="Center" HorizontalAlignment="Center" 
                           Foreground="White"/>
                </Border>
            </Grid>

            <!-- Account Utility -->
            <Grid Margin="8" VerticalAlignment="Top" HorizontalAlignment="Right"
                  Cursor="Hand" MouseDown="btnAccount_Click" TouchDown="btnAccount_Click"
                  ToolTip="{lex:Loc AccountUtility}">
                <Border CornerRadius="5,16,16,5" VerticalAlignment="Center" HorizontalAlignment="Left">
                    <Border.Background>
                        <SolidColorBrush Color="#FF004867" Opacity="0.32"/>
                    </Border.Background>
                    <StackPanel Orientation="Horizontal" Margin="2,0,32,0">
                        <Label Content="{lex:Loc AccountUtility}" Style="{StaticResource input_label}" Foreground="WhiteSmoke"/>
                    </StackPanel>
                </Border>
                <Border CornerRadius="32" Background="#FF004867" Width="32" Height="32" VerticalAlignment="Top" HorizontalAlignment="Right"
                        BorderBrush="White" BorderThickness="1">
                    <Label Content="M" FontFamily="/Cognitivo;component/Resources/#cognitivo" FontSize="15" 
                           VerticalAlignment="Center" HorizontalAlignment="Center" 
                           Foreground="White"/>
                </Border>
            </Grid>
        </StackPanel>
    </Grid>
</Page>
